#!/bin/bash

failed=0;
root_dir=`dirname $(readlink -f $0)`/../../;

for FILENAME in `git diff --name-only --staged`
do
  full_path=${root_dir}${FILENAME};
  result=`php -n -d 'extension=tokenizer.so;' ${root_dir}/vendor/fabpot/php-cs-fixer/php-cs-fixer fix ${full_path} --dry-run`;
  if [[ ${result} == *"1)"* ]]
  then
    echo ${FILENAME}' failed the php-cs-fixer check';
    failed=1;
  fi
done

exit ${failed};
